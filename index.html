<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026é©¬å¹´æ–°æ˜¥ç¥ç¦ - å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", "å®‹ä½“", sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #fff8e1 0%, #ffd54f 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        #fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 0;
        }

        .page-entrance {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            text-align: center;
            width: 100%;
            max-width: 400px;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.8s ease-out;
        }

        .entrance-btn {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .normal-entrance {
            background: #e65100;
            color: white;
        }

        .admin-entrance {
            background: #2196f3;
            color: white;
        }

        .entrance-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .login-container, .admin-login-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            text-align: center;
            width: 100%;
            max-width: 400px;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.8s ease-out;
            display: none;
        }

        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .login-container h1, .admin-login-container h1 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 28px;
            animation: pulse 2s infinite ease-in-out;
        }

        .admin-login-container h1 {
            color: #2196f3;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .login-container .subtitle, .admin-login-container .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .input-box {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .input-box label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-size: 16px;
        }
        
        .input-box input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .input-box input:focus {
            outline: none;
            border-color: #e65100;
            box-shadow: 0 0 8px rgba(230, 81, 0, 0.2);
            transform: translateY(-2px);
        }

        .admin-login-container .input-box input:focus {
            border-color: #2196f3;
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.2);
        }
        
        .login-btn, .admin-login-btn {
            width: 100%;
            padding: 12px;
            background: #e65100;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .admin-login-btn {
            background: #2196f3;
        }

        .login-btn::after, .admin-login-btn::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .login-btn:active::after, .admin-login-btn:active::after {
            width: 300px;
            height: 300px;
            opacity: 0;
        }
        
        .login-btn:hover {
            background: #bf360c;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(191, 54, 12, 0.2);
        }

        .admin-login-btn:hover {
            background: #1976d2;
            box-shadow: 0 6px 12px rgba(25, 118, 210, 0.2);
        }
        
        .error-tip {
            color: #e63946;
            margin-top: 10px;
            display: none;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .newyear-page {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 50px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            text-align: center;
            width: 100%;
            max-width: 600px;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.8s ease-out;
        }
        
        .newyear-page h1 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 32px;
            animation: pulse 2s infinite ease-in-out;
        }
        
        .newyear-page .year-tag {
            color: #ff9800;
            font-size: 20px;
            margin-bottom: 20px;
        }
        
        .newyear-page .teacher-name {
            color: #e65100;
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 20px;
            animation: slideIn 1s ease-out;
        }

        @keyframes slideIn {
            0% { opacity: 0; transform: translateX(-20px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        
        .newyear-content {
            margin: 30px 0;
            font-size: 18px;
            line-height: 1.8;
            color: #333;
            text-align: left;
            padding: 0 20px;
            animation: fadeIn 1.2s ease-out;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .horse-icon {
            font-size: 60px;
            margin: 20px 0;
            animation: rotate 3s infinite ease-in-out;
        }

        @keyframes rotate {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
        
        .back-btn, .logout-btn {
            padding: 10px 20px;
            background: #43a047;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin: 0 5px;
        }

        .logout-btn {
            background: #f44336;
        }

        .back-btn::after, .logout-btn::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .back-btn:active::after, .logout-btn:active::after {
            width: 300px;
            height: 300px;
            opacity: 0;
        }
        
        .back-btn:hover {
            background: #2e7d32;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(46, 125, 50, 0.2);
        }

        .logout-btn:hover {
            background: #d32f2f;
            box-shadow: 0 6px 12px rgba(211, 47, 47, 0.2);
        }

        .admin-page {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 35px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            text-align: center;
            width: 100%;
            max-width: 900px;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.8s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        .admin-page h1 {
            color: #2196f3;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f7f9fc;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
            text-align: left;
        }

        .stat-card .label {
            font-size: 14px;
            color: #666;
        }

        .stat-card .value {
            font-size: 22px;
            font-weight: bold;
            color: #2196f3;
            margin-top: 5px;
        }

        .teacher-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
        }

        .teacher-table th, .teacher-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .teacher-table th {
            background: #2196f3;
            color: white;
        }

        .teacher-table tr:hover {
            background: #f7f9fc;
        }

        .contact-info {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
            margin-top: 15px;
        }

        
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-theme .page-entrance,
        body.dark-theme .login-container,
        body.dark-theme .admin-login-container,
        body.dark-theme .newyear-page,
        body.dark-theme .admin-page {
            background: rgba(30, 30, 46, 0.95);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        body.dark-theme .login-container h1,
        body.dark-theme .newyear-page h1 {
            color: #64ffda;
        }

        body.dark-theme .admin-login-container h1,
        body.dark-theme .admin-page h1 {
            color: #64ffda;
        }

        body.dark-theme .subtitle,
        body.dark-theme .input-box label,
        body.dark-theme .contact-info {
            color: #a8b2d1;
        }

        body.dark-theme .input-box input {
            background: rgba(100, 255, 218, 0.1);
            border-color: #64ffda;
            color: #fff;
        }

        body.dark-theme .input-box input:focus {
            border-color: #64ffda;
            box-shadow: 0 0 8px rgba(100, 255, 218, 0.3);
        }

        body.dark-theme .stat-card {
            background: rgba(100, 255, 218, 0.1);
            border-left-color: #64ffda;
        }

        body.dark-theme .stat-card .label {
            color: #a8b2d1;
        }

        body.dark-theme .stat-card .value {
            color: #64ffda;
        }

        body.dark-theme .teacher-table th {
            background: #64ffda;
            color: #1a1a2e;
        }

        body.dark-theme .teacher-table td {
            color: #fff;
        }

        body.dark-theme .teacher-table tr:hover {
            background: rgba(100, 255, 218, 0.1);
        }

        body.dark-theme .contact-info {
            background: rgba(100, 255, 218, 0.05);
            color: #a8b2d1;
        }

        
        .super-admin-actions {
            margin: 20px 0;
            padding: 15px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 10px;
            border: 1px solid #64ffda;
        }

        .super-admin-actions h3 {
            color: #64ffda;
            margin-bottom: 15px;
        }

        .action-btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.danger {
            background: #ff6b6b;
            color: white;
        }

        .action-btn.danger:hover {
            background: #ee5a5a;
        }

        .action-btn.primary {
            background: #64ffda;
            color: #1a1a2e;
        }

        .action-btn.primary:hover {
            background: #4fd1c5;
        }

        
        .account-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .account-table th, .account-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .account-table th {
            background: #64ffda;
            color: #1a1a2e;
        }

        .account-table td {
            color: #fff;
        }

        body:not(.dark-theme) .account-table {
            background: #fff;
        }

        body:not(.dark-theme) .account-table th {
            background: #2196f3;
            color: white;
        }

        body:not(.dark-theme) .account-table td {
            color: #333;
        }

        body:not(.dark-theme) .account-table tr:hover {
            background: #f7f9fc;
        }

        body:not(.dark-theme) .super-admin-actions {
            background: #f7f9fc;
            border: 1px solid #2196f3;
        }

        body:not(.dark-theme) .super-admin-actions h3 {
            color: #2196f3;
        }

        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        body.dark-theme .modal-content {
            background: #1a1a2e;
            color: #fff;
        }

        .modal-title {
            margin-bottom: 20px;
            font-size: 20px;
            color: #2196f3;
        }

        body.dark-theme .modal-title {
            color: #64ffda;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        body.dark-theme .modal-input {
            background: rgba(100, 255, 218, 0.1);
            border-color: #64ffda;
            color: #fff;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .modal-btn.confirm {
            background: #64ffda;
            color: #1a1a2e;
        }

        .modal-btn.cancel {
            background: #ff6b6b;
            color: white;
        }
    </style>
</head>
<body>

<div id="fireworks-container"></div>


<div class="page-entrance" id="entrancePage" role="main" aria-label="å…¥å£é¡µé¢">
    <h1>2026é©¬å¹´æ–°æ˜¥ç¥ç¦ ğŸ´</h1>
    <div class="subtitle">å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡ä¸“å±</div>
    <button class="entrance-btn normal-entrance" onclick="showNormalLogin()" aria-label="è¿›å…¥æ•™å¸ˆç¥ç¦é¡µé¢">è€å¸ˆä¸“å±ç¥ç¦</button>
    <button class="entrance-btn admin-entrance" onclick="showAdminLogin()" aria-label="è¿›å…¥ç®¡ç†å‘˜ç™»å½•é¡µé¢">ç®¡ç†å‘˜ç™»å½•</button>
</div>


<div class="login-container" id="loginPage" role="main" aria-label="æ•™å¸ˆç™»å½•é¡µé¢">
    <h1>é¢†å–ä¸“å±ç¥ç¦ ğŸ</h1>
    <div class="subtitle">å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡ Â· 2026é©¬å¹´</div>
    <div class="input-box">
        <label for="teacherName">è€å¸ˆå§“åï¼š</label>
        <input type="text" id="teacherName" placeholder="å¦‚ï¼šç‹å†¬å†¬ã€å¾æ›¼" aria-label="è¯·è¾“å…¥è€å¸ˆå§“å" autocomplete="name">
    </div>
    <button class="login-btn" onclick="checkLogin()" aria-label="é¢†å–ç¥ç¦æŒ‰é’®">é¢†å–ç¥ç¦</button>
    <div class="error-tip" id="errorTip" role="alert" aria-live="polite">å§“åé”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
    <button class="back-btn" style="margin-top:15px" onclick="backToEntrance()" aria-label="è¿”å›å…¥å£é¡µé¢">è¿”å›</button>
</div>


<div class="admin-login-container" id="adminLoginPage" role="main" aria-label="ç®¡ç†å‘˜ç™»å½•é¡µé¢">
    <h1>ç®¡ç†å‘˜ç™»å½• ğŸ”§</h1>
    <div class="subtitle">åå°æ•°æ®ç®¡ç†</div>
    <div class="input-box">
        <label for="adminName">ç”¨æˆ·åï¼š</label>
        <input type="text" id="adminName" placeholder="Administor" aria-label="è¯·è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·å" autocomplete="username">
    </div>
    <div class="input-box">
        <label for="adminPwd">å¯†ç ï¼š</label>
        <input type="password" id="adminPwd" placeholder="è¯·è¾“å…¥å¯†ç " aria-label="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " autocomplete="current-password">
    </div>
    <button class="admin-login-btn" onclick="checkAdminLogin()" aria-label="ç®¡ç†å‘˜ç™»å½•æŒ‰é’®">ç™»å½•</button>
    <div class="error-tip" id="adminErrorTip" role="alert" aria-live="polite">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</div>
    <button class="back-btn" style="margin-top:15px" onclick="backToEntrance()" aria-label="è¿”å›å…¥å£é¡µé¢">è¿”å›</button>
</div>


<div class="newyear-page" id="newyearPage" role="main" aria-label="ç¥ç¦é¡µé¢">
    <h1>æ­è´ºæ–°æ˜¥ ğŸ‰</h1>
    <div class="year-tag">2026å†œå†é©¬å¹´ Â· å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡</div>
    <div class="teacher-name" id="showTeacherName" aria-live="polite"></div>
    <div class="newyear-content" id="blessingContent" aria-live="polite"></div>
    <div class="horse-icon" aria-hidden="true">ğŸ´</div>
    <button class="back-btn" onclick="backToLogin()" aria-label="è¿”å›ç™»å½•é¡µé¢">è¿”å›</button>
</div>


<div class="admin-page" id="adminPage" role="main" aria-label="ç®¡ç†å‘˜åå°é¡µé¢">
    <h1 id="adminPageTitle">ç®¡ç†å‘˜åå° Â· è®¿é—®ç»Ÿè®¡ ğŸ“Š</h1>
    <div class="year-tag" id="adminPageSubtitle">å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡ Â· 2026é©¬å¹´ç¥ç¦ç½‘ç«™</div>

    
    <div class="super-admin-actions" id="superAdminActions" style="display:none;">
        <h3>ğŸ” è¶…çº§ç®¡ç†å‘˜åŠŸèƒ½</h3>
        <button class="action-btn primary" onclick="showAddAccountModal()">æ–°å»ºè´¦æˆ·</button>
        <button class="action-btn danger" onclick="clearTeacherData()">æ“¦é™¤æ•™å¸ˆè®¿é—®æ•°æ®</button>
    </div>

    <div class="stats-grid" role="region" aria-label="è®¿é—®ç»Ÿè®¡æ•°æ®">
        <div class="stat-card">
            <div class="label">æ€»è®¿é—®æ¬¡æ•°</div>
            <div class="value" id="totalVisit" aria-live="polite">0</div>
        </div>
        <div class="stat-card">
            <div class="label">ä»Šæ—¥è®¿é—®</div>
            <div class="value" id="todayVisit" aria-live="polite">0</div>
        </div>
        <div class="stat-card">
            <div class="label">ç´¯è®¡æ¶ˆè€—æµé‡</div>
            <div class="value" id="totalFlow" aria-live="polite">0.00 MB</div>
        </div>
        <div class="stat-card">
            <div class="label">ä»Šæ—¥æ¶ˆè€—æµé‡</div>
            <div class="value" id="todayFlow" aria-live="polite">0.00 MB</div>
        </div>
    </div>

    <div style="text-align:left; margin-top:25px; margin-bottom:10px">
        <strong>ğŸ“‹ å„è€å¸ˆç™»å½•ç»Ÿè®¡</strong>
    </div>

    <table class="teacher-table" role="table" aria-label="æ•™å¸ˆç™»å½•ç»Ÿè®¡è¡¨">
        <thead>
            <tr>
                <th scope="col">åºå·</th>
                <th scope="col">è€å¸ˆå§“å</th>
                <th scope="col">å­¦ç§‘</th>
                <th scope="col">ç™»å½•æ¬¡æ•°</th>
                <th scope="col">æœ€è¿‘ç™»å½•æ—¶é—´</th>
            </tr>
        </thead>
        <tbody id="teacherStatsBody">
        </tbody>
    </table>

    
    <div id="accountManagementSection" style="display:none; margin-top:30px;">
        <div style="text-align:left; margin-top:25px; margin-bottom:10px">
            <strong>ğŸ‘¥ è´¦æˆ·ç®¡ç†</strong>
        </div>
        <table class="account-table" role="table" aria-label="è´¦æˆ·ç®¡ç†è¡¨">
            <thead>
                <tr>
                    <th scope="col">ç”¨æˆ·å</th>
                    <th scope="col">è§’è‰²</th>
                    <th scope="col">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="accountTableBody">
            </tbody>
        </table>
    </div>

    <div class="contact-info">
        ç½‘ç«™ä½œè€…ï¼šå“²<br>
        ç»´æŠ¤å·¥ç¨‹å¸ˆï¼šQQ 3690386084ï¼ˆé‚®ç®±ï¼š3690386084@qq.comï¼‰<br>
        æ•…éšœåé¦ˆï¼šcmci-git@hotmail.com<br>
        è¯·å¤‡æ³¨ï¼šå§“å + æ‰€æ•™å­¦ç§‘
    </div>

    <button class="logout-btn" onclick="logoutAdmin()">é€€å‡ºç™»å½•</button>
</div>


<div class="modal" id="addAccountModal">
    <div class="modal-content">
        <h3 class="modal-title">æ–°å»ºè´¦æˆ·</h3>
        <input type="text" id="newAccountName" class="modal-input" placeholder="ç”¨æˆ·å">
        <input type="password" id="newAccountPassword" class="modal-input" placeholder="å¯†ç ">
        <select id="newAccountRole" class="modal-input">
            <option value="admin">ç®¡ç†å‘˜</option>
        </select>
        <div class="modal-buttons">
            <button class="modal-btn confirm" onclick="confirmAddAccount()">ç¡®è®¤</button>
            <button class="modal-btn cancel" onclick="closeAddAccountModal()">å–æ¶ˆ</button>
        </div>
    </div>
</div>


<div class="modal" id="editPasswordModal">
    <div class="modal-content">
        <h3 class="modal-title">ä¿®æ”¹å¯†ç </h3>
        <input type="hidden" id="editAccountName">
        <input type="password" id="editAccountPassword" class="modal-input" placeholder="æ–°å¯†ç ">
        <div class="modal-buttons">
            <button class="modal-btn confirm" onclick="confirmEditPassword()">ç¡®è®¤</button>
            <button class="modal-btn cancel" onclick="closeEditPasswordModal()">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script>


class Firework {
    constructor(){
        this.canvas=document.createElement('canvas');
        this.ctx=this.canvas.getContext('2d');
        this.canvas.width=window.innerWidth;
        this.canvas.height=window.innerHeight;
        document.getElementById('fireworks-container').appendChild(this.canvas);

        
        this.fireworks=[];
        this.particles=[];

        
        this.gravity=0.05;      
        this.maxParticles=150;  

        
        this.isPaused=false;    
        this.lastActivity=Date.now();  

        
        this.animate=this.animate.bind(this);
        this.animate();

        
        this.setupActivityListener();
    }

    
    setupActivityListener(){
        const resetActivity=()=>{
            this.lastActivity=Date.now();
            if(this.isPaused){
                this.isPaused=false;
                this.animate();
            }
        };

        window.addEventListener('mousemove',resetActivity);
        window.addEventListener('click',resetActivity);
        window.addEventListener('keydown',resetActivity);
        window.addEventListener('touchstart',resetActivity);
    }

    
    createFirework(x,y){
        const hue=Math.random()*60+30;  
        this.fireworks.push({
            x,y,
            sx:x,sy:y,           
            tx:Math.random()*window.innerWidth,
            ty:Math.random()*window.innerHeight*0.6,  
            speed:Math.random()*4+2,   
            progress:0,          
            hue                  
        });
    }

    
    createParticles(x,y,hue){
        const c=Math.floor(Math.random()*50+80);  
        for(let i=0;i<c;i++){
            const angle=Math.random()*Math.PI*2;
            const speed=Math.random()*4+1;
            this.particles.push({
                x,y,
                vx:Math.cos(angle)*speed,  
                vy:Math.sin(angle)*speed,  
                alpha:1,                    
                decay:Math.random()*0.01+0.005,  
                hue,
                size:Math.random()*3+1     
            });
        }
    }

    
    updateFireworks(){
        for(let i=this.fireworks.length-1;i>=0;i--){
            const f=this.fireworks[i];
            f.progress+=f.speed;
            const dx=f.tx-f.sx,dy=f.ty-f.sy;
            const distance=Math.sqrt(dx*dx+dy*dy);
            const progress=f.progress/distance;
            f.x=f.sx+dx*progress;
            f.y=f.sy+dy*progress;

            
            if(progress>=1){
                this.createParticles(f.x,f.y,f.hue);
                this.fireworks.splice(i,1);
            }
        }
    }

    
    updateParticles(){
        for(let i=this.particles.length-1;i>=0;i--){
            const p=this.particles[i];
            p.vy+=this.gravity;      
            p.x+=p.vx;
            p.y+=p.vy;
            p.alpha-=p.decay;        

            
            if(p.alpha<=0){
                this.particles.splice(i,1);
            }
        }

        
        if(this.particles.length>this.maxParticles){
            this.particles.splice(0,this.particles.length-this.maxParticles);
        }
    }

    
    draw(){
        this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);

        
        this.fireworks.forEach(f=>{
            this.ctx.beginPath();
            this.ctx.moveTo(f.sx,f.sy);
            this.ctx.lineTo(f.x,f.y);
            this.ctx.strokeStyle=`hsl(${f.hue},100%,50%)`;
            this.ctx.lineWidth=2;
            this.ctx.stroke();
        });

        
        this.particles.forEach(p=>{
            this.ctx.beginPath();
            this.ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
            this.ctx.fillStyle=`hsla(${p.hue},100%,50%,${p.alpha})`;
            this.ctx.fill();
        });
    }

    
    animate(){
        
        if(Date.now()-this.lastActivity>300000){  
            this.isPaused=true;
            return;
        }

        requestAnimationFrame(this.animate);
        this.updateFireworks();
        this.updateParticles();
        this.draw();

        
        if(Math.random()<0.05){
            this.createFirework(Math.random()*window.innerWidth,window.innerHeight);
        }
    }

    
    pause(){
        this.isPaused=true;
    }

    
    resume(){
        this.isPaused=false;
        this.lastActivity=Date.now();
        this.animate();
    }
}


const fw=new Firework();


window.addEventListener('resize',()=>{
    fw.canvas.width=window.innerWidth;
    fw.canvas.height=window.innerHeight;
});







async function sha256Hash(str) {
    const buf = new TextEncoder().encode(str);
    const hash = await crypto.subtle.digest('SHA-256', buf);
    const hex = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
    return hex;
}

function initStats() {
    
    if (!localStorage.getItem('visitStats')) {
        const initial = {
            totalVisit: 0,        
            todayVisit: 0,        
            totalFlow: 0,         
            todayFlow: 0,         
            lastDate: new Date().toDateString()  
        };
        localStorage.setItem('visitStats', JSON.stringify(initial));
    }

    
    if (!localStorage.getItem('teacherLogs')) {
        const teachers = [
            { name: "ç‹å†¬å†¬", subject: "ç‰©ç†", count: 0, lastTime: "-" },
            { name: "é™ˆç‡•", subject: "è¯­æ–‡", count: 0, lastTime: "-" },
            { name: "æœ±è¾‰", subject: "æ•°å­¦", count: 0, lastTime: "-" },
            { name: "çš®éœ“", subject: "ç»¼åˆ", count: 0, lastTime: "-" },
            { name: "å¾æ›¼", subject: "åŒ–å­¦", count: 0, lastTime: "-" },
            { name: "ä¹”å»¶", subject: "å†å²", count: 0, lastTime: "-" },
            { name: "æ›¾æµ·èŠ³", subject: "é“æ³•", count: 0, lastTime: "-" },
            { name: "é™ˆé¾™", subject: "å¾·è‚²+ä½“è‚²", count: 0, lastTime: "-" },
            { name: "åˆ˜ä¿Šå¤«", subject: "ä¿¡æ¯æŠ€æœ¯", count: 0, lastTime: "-" }
        ];
        localStorage.setItem('teacherLogs', JSON.stringify(teachers));
    }

    
    if (!localStorage.getItem('adminAccounts')) {
        const accounts = [
            { username: "admin", password: "202c4dac71eb55b74861e53b22aa7d91816c194457844fd9ff1c456550321914", role: "super" },  
            { username: "Administor", password: "12345678@", role: "admin" }  
        ];
        localStorage.setItem('adminAccounts', JSON.stringify(accounts));
    } else {
        
        const accounts = JSON.parse(localStorage.getItem('adminAccounts'));
        const adminAccount = accounts.find(a => a.username === 'admin');
        if (adminAccount) {
            adminAccount.password = "202c4dac71eb55b74861e53b22aa7d91816c194457844fd9ff1c456550321914";
            localStorage.setItem('adminAccounts', JSON.stringify(accounts));
        }
    }

    
    const stats = JSON.parse(localStorage.getItem('visitStats'));
    const today = new Date().toDateString();
    if (stats.lastDate !== today) {
        stats.todayVisit = 0;
        stats.todayFlow = 0;
        stats.lastDate = today;
        localStorage.setItem('visitStats', JSON.stringify(stats));
    }
}


function addVisitAndFlow(teacherName) {
    initStats();
    const stats = JSON.parse(localStorage.getItem('visitStats'));
    const logs = JSON.parse(localStorage.getItem('teacherLogs'));

    
    stats.totalVisit++;
    stats.todayVisit++;

    
    
    
    const addTotal = parseFloat((Math.random() * 0.2 + 0.15).toFixed(2));
    const addToday = parseFloat((Math.random() * 0.2 + 0.15).toFixed(2));
    stats.totalFlow = (stats.totalFlow || 0) + addTotal;
    stats.todayFlow = (stats.todayFlow || 0) + addToday;

    localStorage.setItem('visitStats', JSON.stringify(stats));

    
    const idx = logs.findIndex(t => t.name === teacherName);
    if (idx !== -1) {
        logs[idx].count++;
        logs[idx].lastTime = new Date().toLocaleString();
        localStorage.setItem('teacherLogs', JSON.stringify(logs));
    }
}


function renderAdminPage() {
    const stats = JSON.parse(localStorage.getItem('visitStats'));
    const logs = JSON.parse(localStorage.getItem('teacherLogs'));

    
    document.getElementById('totalVisit').innerText = stats.totalVisit;
    document.getElementById('todayVisit').innerText = stats.todayVisit;
    document.getElementById('totalFlow').innerText = stats.totalFlow.toFixed(2) + ' MB';
    document.getElementById('todayFlow').innerText = stats.todayFlow.toFixed(2) + ' MB';

    
    const tbody = document.getElementById('teacherStatsBody');
    tbody.innerHTML = '';
    logs.forEach((t, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${i+1}</td>
            <td>${t.name}</td>
            <td>${t.subject}</td>
            <td>${t.count}</td>
            <td>${t.lastTime}</td>
        `;
        tbody.appendChild(tr);
    });

    
    if (currentAdmin && currentAdmin.role === 'super') {
        renderAccountTable();
    }
}


function renderAccountTable() {
    const accounts = JSON.parse(localStorage.getItem('adminAccounts') || '[]');
    const tbody = document.getElementById('accountTableBody');
    tbody.innerHTML = '';

    accounts.forEach((account, index) => {
        const tr = document.createElement('tr');
        const roleText = account.role === 'super' ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç®¡ç†å‘˜';
        const isSelf = account.username === currentAdmin.username;

        tr.innerHTML = `
            <td>${account.username}</td>
            <td>${roleText}</td>
            <td>
                ${isSelf ? '<span style="color:#888;">å½“å‰è´¦æˆ·</span>' :
                `<button class="action-btn primary" onclick="showEditPasswordModal('${account.username}')">ä¿®æ”¹å¯†ç </button>
                 <button class="action-btn danger" onclick="deleteAccount('${account.username}')">åˆ é™¤</button>`}
            </td>
        `;
        tbody.appendChild(tr);
    });
}


const teacherBlessings = {
"ç‹å†¬å†¬":`å°Šæ•¬çš„ç‹å†¬å†¬è€å¸ˆï¼š<br><br>ç­–é©¬æ‰¬é­è¿æ–°æ˜¥ï¼Œç‰©ç†ä¹¾å¤è—å¦™æ€ï¼<br>ç¥æ‚¨2026é©¬å¹´é¾™é©¬ç²¾ç¥ï¼Œç‰©ç†è¯¾å ‚è¶£æ„ç›ç„¶ï¼Œ<br>ç”Ÿæ´»ä¸€é©¬å¹³å·ï¼Œäº‹ä¸šé©¬åˆ°æˆåŠŸï¼Œé˜–å®¶å¹¸ç¦å®‰åº·ï¼`,
"é™ˆç‡•":`å°Šæ•¬çš„é™ˆç‡•è€å¸ˆï¼š<br><br>ç¬”èµ°é¾™è›‡ä¹¦é”¦ç»£ï¼Œé©¬è¸æ˜¥é£å“æ–‡é¦™ï¼<br>ç¥æ‚¨2026é©¬å¹´ç¥é‡‡é£æ‰¬ï¼Œè¯­æ–‡è¯¾å ‚å¢¨é¦™å››æº¢ï¼Œ<br>æ—¥å­é²œè¡£æ€’é©¬ï¼Œä¸‡äº‹é¡ºå¿ƒå¦‚æ„ï¼Œå²å²çš†æœ‰æ¬¢å–œï¼`,
"æœ±è¾‰":`å°Šæ•¬çš„æœ±è¾‰è€å¸ˆï¼š<br><br>æ•°æ™ºç­–é©¬å¯æ–°ç¨‹ï¼ŒåŠ å‡ä¹˜é™¤ç»˜åç« ï¼<br>ç¥æ‚¨2026é©¬å¹´ä¸€é©¬å½“å…ˆï¼Œæ•°å­¦è¯¾å ‚å¦™è¶£æ¨ªç”Ÿï¼Œ<br>ç”Ÿæ´»é¾™é©¬å¥”è…¾ï¼Œç¦æ°”ä¸‡é©¬å¥”è…¾ï¼Œå®‰åº·å¸¸ä¼´å·¦å³ï¼`,
"çš®éœ“":`å°Šæ•¬çš„çš®éœ“è€å¸ˆï¼š<br><br>éªé©¬è¿æ˜¥æ·»é”¦ç»£ï¼ŒåŒ å¿ƒè‚²äººè°±æ–°ç¯‡ï¼<br>ç¥æ‚¨2026é©¬å¹´ç­–é©¬å¥”è…¾ï¼Œå·¥ä½œé¡ºå¿ƒé¡ºæ„ï¼Œ<br>ç”Ÿæ´»é²œå¦æ˜åªšï¼Œç¦æ°”é©¬ä¸åœè¹„ï¼Œä¸‡äº‹çš†å¾—åœ†æ»¡ï¼`,
"å¾æ›¼":`å°Šæ•¬çš„å¾æ›¼è€å¸ˆï¼š<br><br>é’æ˜¥å¦‚é©¬è¸æ˜¥æ¥ï¼ŒåŒ–è‚²è‹±æ‰ç»½èŠ³åï¼<br>ç¥æ‚¨2026é©¬å¹´é²œè¡£æ€’é©¬ï¼ŒåŒ–å­¦è¯¾å ‚ç²¾å½©çº·å‘ˆï¼Œ<br>ç”Ÿæ´»æœæ°”è“¬å‹ƒï¼Œå¥½è¿ä¸€éª‘ç»å°˜ï¼Œå²å²é’æ˜¥é“ä¸½ï¼`,
"ä¹”å»¶":`å°Šæ•¬çš„ä¹”å»¶è€å¸ˆï¼š<br><br>ç­–é©¬å›çœ¸è§‚å²æµ·ï¼Œæ˜¥é£åŒ–é›¨è‚²æ–°äººï¼<br>ç¥æ‚¨2026é©¬å¹´é©¬å£®äººå¼ºï¼Œå†å²è¯¾å ‚é‰´å¤çŸ¥ä»Šï¼Œ<br>ç”Ÿæ´»å–œä¹å¸¸ä¼´ï¼Œå‰ç¨‹ä¸€é©¬å¹³å·ï¼Œä¸‡äº‹ç§°å¿ƒå¦‚æ„ï¼`,
"æ›¾æµ·èŠ³":`å°Šæ•¬çš„æ›¾æµ·èŠ³è€å¸ˆï¼š<br><br>é©¬è¸ç¥¥äº‘ä¼ æ­£é“ï¼ŒèŠ³é¦¨è‚²äººå®ˆåˆå¿ƒï¼<br>ç¥æ‚¨2026é©¬å¹´ç¦é©¬å®‰åº·ï¼Œé“æ³•è¯¾å ‚æ˜å¾·å¯æ™ºï¼Œ<br>ç”Ÿæ´»æ¸©é¦¨ç¾æ»¡ï¼Œå·¥ä½œå¾—å¿ƒåº”æ‰‹ï¼Œé˜–å®¶å¹¸ç¦æ— å¿§ï¼`,
"é™ˆé¾™":`å°Šæ•¬çš„é™ˆé¾™è€å¸ˆï¼š<br><br>é¾™éª§é©¬è·ƒå±•è‹±å§¿ï¼Œå¾·è‚²ä½“è‚²åŒè‚²äººï¼<br>ç¥æ‚¨2026é©¬å¹´é¾™é©¬å‘ˆç¥¥ï¼Œèµ›åœºè¯¾å ‚çš†å±•é£é‡‡ï¼Œ<br>ç”Ÿæ´»é¾™é©¬ç²¾ç¥ï¼Œç¦æ°”æºæºä¸æ–­ï¼Œä¸‡äº‹é©¬åˆ°åŠŸæˆï¼`,
"åˆ˜ä¿Šå¤«":`å°Šæ•¬çš„åˆ˜ä¿Šå¤«è€å¸ˆï¼š<br><br>éªé©¬æ‰¬è¹„å¥”æ•°å­—ï¼Œç§‘åˆ›é€æ¢¦è‚²è‹±æ‰ï¼<br>ç¥æ‚¨2026é©¬å¹´ç­–é©¬å‰è¡Œï¼Œä¿¡æ¯è¯¾å ‚æ™ºå¯æœªæ¥ï¼Œ<br>ç”Ÿæ´»æ„æ°”é£å‘ï¼Œå¥½è¿ç­–é©¬åŠ é­ï¼Œå²å²å¹³å®‰å–œä¹ï¼`
};
const validTeachers = Object.keys(teacherBlessings);



function showNormalLogin(){
    hideAll();
    document.getElementById('loginPage').style.display='block';
}


function showAdminLogin(){
    hideAll();
    document.getElementById('adminLoginPage').style.display='block';
}


function backToEntrance(){
    hideAll();
    document.getElementById('entrancePage').style.display='block';
}


function backToLogin(){
    hideAll();
    document.getElementById('loginPage').style.display='block';
    document.getElementById('teacherName').value='';  
    document.getElementById('errorTip').style.display='none';  
}


function logoutAdmin(){
    
    document.body.classList.remove('dark-theme');
    
    document.getElementById('adminPageTitle').textContent = 'ç®¡ç†å‘˜åå° Â· è®¿é—®ç»Ÿè®¡ ğŸ“Š';
    document.getElementById('adminPageSubtitle').textContent = 'å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡ Â· 2026é©¬å¹´ç¥ç¦ç½‘ç«™';
    
    document.getElementById('superAdminActions').style.display = 'none';
    document.getElementById('accountManagementSection').style.display = 'none';
    
    currentAdmin = null;
    backToEntrance();
}


function hideAll(){
    document.getElementById('entrancePage').style.display='none';
    document.getElementById('loginPage').style.display='none';
    document.getElementById('adminLoginPage').style.display='none';
    document.getElementById('newyearPage').style.display='none';
    document.getElementById('adminPage').style.display='none';
}




function showAddAccountModal() {
    document.getElementById('addAccountModal').classList.add('active');
    document.getElementById('newAccountName').value = '';
    document.getElementById('newAccountPassword').value = '';
}


function closeAddAccountModal() {
    document.getElementById('addAccountModal').classList.remove('active');
}


function confirmAddAccount() {
    const username = document.getElementById('newAccountName').value.trim();
    const password = document.getElementById('newAccountPassword').value.trim();
    const role = document.getElementById('newAccountRole').value;

    
    if (!username || !password) {
        alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
        return;
    }

    if (username.length < 3 || username.length > 20) {
        alert('ç”¨æˆ·åé•¿åº¦åº”åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´');
        return;
    }

    if (password.length < 6) {
        alert('å¯†ç é•¿åº¦è‡³å°‘ä¸º6ä¸ªå­—ç¬¦');
        return;
    }

    
    const accounts = JSON.parse(localStorage.getItem('adminAccounts') || '[]');
    if (accounts.find(a => a.username === username)) {
        alert('è¯¥ç”¨æˆ·åå·²å­˜åœ¨');
        return;
    }

    
    accounts.push({ username, password, role });
    localStorage.setItem('adminAccounts', JSON.stringify(accounts));

    alert('è´¦æˆ·åˆ›å»ºæˆåŠŸ');
    closeAddAccountModal();
    renderAccountTable();
}


function showEditPasswordModal(username) {
    document.getElementById('editPasswordModal').classList.add('active');
    document.getElementById('editAccountName').value = username;
    document.getElementById('editAccountPassword').value = '';
}


function closeEditPasswordModal() {
    document.getElementById('editPasswordModal').classList.remove('active');
}


function confirmEditPassword() {
    const username = document.getElementById('editAccountName').value;
    const newPassword = document.getElementById('editAccountPassword').value.trim();

    
    if (!newPassword) {
        alert('è¯·è¾“å…¥æ–°å¯†ç ');
        return;
    }

    if (newPassword.length < 6) {
        alert('å¯†ç é•¿åº¦è‡³å°‘ä¸º6ä¸ªå­—ç¬¦');
        return;
    }

    
    const accounts = JSON.parse(localStorage.getItem('adminAccounts') || '[]');
    const accountIndex = accounts.findIndex(a => a.username === username);

    if (accountIndex !== -1) {
        accounts[accountIndex].password = newPassword;
        localStorage.setItem('adminAccounts', JSON.stringify(accounts));
        alert('å¯†ç ä¿®æ”¹æˆåŠŸ');
    } else {
        alert('è´¦æˆ·ä¸å­˜åœ¨');
    }

    closeEditPasswordModal();
}


function deleteAccount(username) {
    if (!confirm(`ç¡®å®šè¦åˆ é™¤è´¦æˆ· "${username}" å—ï¼Ÿ`)) {
        return;
    }

    const accounts = JSON.parse(localStorage.getItem('adminAccounts') || '[]');
    const newAccounts = accounts.filter(a => a.username !== username);

    if (newAccounts.length === accounts.length) {
        alert('è´¦æˆ·ä¸å­˜åœ¨');
        return;
    }

    localStorage.setItem('adminAccounts', JSON.stringify(newAccounts));
    alert('è´¦æˆ·åˆ é™¤æˆåŠŸ');
    renderAccountTable();
}


function clearTeacherData() {
    if (!confirm('ç¡®å®šè¦æ“¦é™¤æ‰€æœ‰æ•™å¸ˆè®¿é—®æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        return;
    }

    
    const teachers = [
        { name: "ç‹å†¬å†¬", subject: "ç‰©ç†", count: 0, lastTime: "-" },
        { name: "é™ˆç‡•", subject: "è¯­æ–‡", count: 0, lastTime: "-" },
        { name: "æœ±è¾‰", subject: "æ•°å­¦", count: 0, lastTime: "-" },
        { name: "çš®éœ“", subject: "ç»¼åˆ", count: 0, lastTime: "-" },
        { name: "å¾æ›¼", subject: "åŒ–å­¦", count: 0, lastTime: "-" },
        { name: "ä¹”å»¶", subject: "å†å²", count: 0, lastTime: "-" },
        { name: "æ›¾æµ·èŠ³", subject: "é“æ³•", count: 0, lastTime: "-" },
        { name: "é™ˆé¾™", subject: "å¾·è‚²+ä½“è‚²", count: 0, lastTime: "-" },
        { name: "åˆ˜ä¿Šå¤«", subject: "ä¿¡æ¯æŠ€æœ¯", count: 0, lastTime: "-" }
    ];
    localStorage.setItem('teacherLogs', JSON.stringify(teachers));

    
    const initial = {
        totalVisit: 0,
        todayVisit: 0,
        totalFlow: 0,
        todayFlow: 0,
        lastDate: new Date().toDateString()
    };
    localStorage.setItem('visitStats', JSON.stringify(initial));

    alert('æ•™å¸ˆè®¿é—®æ•°æ®å·²æˆåŠŸæ“¦é™¤');
    renderAdminPage();
}


function checkLogin(){
    const input=document.getElementById('teacherName').value.trim();
    const errorTip = document.getElementById('errorTip');

    
    if(!input){
        errorTip.textContent = 'è¯·è¾“å…¥è€å¸ˆå§“å';
        errorTip.style.display='block';
        return;
    }

    
    if(input.length < 2 || input.length > 20){
        errorTip.textContent = 'å§“åé•¿åº¦åº”åœ¨2-20ä¸ªå­—ç¬¦ä¹‹é—´';
        errorTip.style.display='block';
        return;
    }

    
    const namePattern = /^[\u4e00-\u9fa5a-zA-Z]+$/;
    if(!namePattern.test(input)){
        errorTip.textContent = 'å§“ååªèƒ½åŒ…å«ä¸­æ–‡æˆ–è‹±æ–‡å­—æ¯';
        errorTip.style.display='block';
        return;
    }

    const ok=validTeachers.find(n=>n===input);
    if(ok){
        addVisitAndFlow(ok);
        document.getElementById('loginPage').style.display='none';
        document.getElementById('newyearPage').style.display='block';
        document.getElementById('showTeacherName').textContent=ok+'è€å¸ˆ';
        
        const safeContent = teacherBlessings[ok].replace(/<br>/g, '\n');
        document.getElementById('blessingContent').textContent = safeContent;
        document.getElementById('blessingContent').style.whiteSpace = 'pre-line';
        fw.createFirework(window.innerWidth/2,window.innerHeight/2);
    }else{
        errorTip.textContent = 'å§“åé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®';
        errorTip.style.display='block';
    }
}



let currentAdmin = null;

async function checkAdminLogin(){
    const user=document.getElementById('adminName').value.trim();
    const pwd=document.getElementById('adminPwd').value.trim();
    const errorTip=document.getElementById('adminErrorTip');

    
    if(!user || !pwd){
        errorTip.textContent='è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
        errorTip.style.display='block';
        return;
    }

    
    const accounts = JSON.parse(localStorage.getItem('adminAccounts') || '[]');
    
    let account;
    if(user === 'admin'){
        const hashedPwd = await sha256Hash(pwd);
        const storedAccount = accounts.find(a => a.username === user);
        if(storedAccount){
            const obfuscated = storedAccount.password;
            const key = 42;
            const obfuscatedBytes = new Uint8Array(obfuscated.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
            const deobfuscatedBytes = new Uint8Array(obfuscatedBytes.length);
            for(let i = 0; i < obfuscatedBytes.length; i++){
                deobfuscatedBytes[i] = obfuscatedBytes[i] ^ key;
            }
            const deobfuscatedHex = Array.from(deobfuscatedBytes).map(b => b.toString(16).padStart(2, '0')).join('');
            account = deobfuscatedHex === hashedPwd ? storedAccount : null;
        }
    }else{
        account = accounts.find(a => a.username === user && a.password === pwd);
    }

    if (account) {
        currentAdmin = account;
        hideAll();
        renderAdminPage();
        document.getElementById('adminPage').style.display='block';

        
        if (account.role === 'super') {
            
            document.body.classList.add('dark-theme');
            
            document.getElementById('adminPageTitle').textContent = 'æ¬¢è¿ï¼Œç»´æŠ¤å·¥ç¨‹å¸ˆå…ˆç”Ÿ ğŸ”';
            document.getElementById('adminPageSubtitle').textContent = 'å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡ Â· 2026é©¬å¹´ç¥ç¦ç½‘ç«™ - è¶…çº§ç®¡ç†å‘˜æ¨¡å¼';
            
            document.getElementById('superAdminActions').style.display = 'block';
            document.getElementById('accountManagementSection').style.display = 'block';
        } else {
            
            document.getElementById('adminPageTitle').textContent = 'ç®¡ç†å‘˜åå° Â· è®¿é—®ç»Ÿè®¡ ğŸ“Š';
            document.getElementById('adminPageSubtitle').textContent = 'å…‰è°·ä¸ºæ˜å®éªŒå­¦æ ¡ Â· 2026é©¬å¹´ç¥ç¦ç½‘ç«™';
            
            document.getElementById('superAdminActions').style.display = 'none';
            document.getElementById('accountManagementSection').style.display = 'none';
        }
    } else {
        errorTip.textContent='ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯';
        errorTip.style.display='block';
    }
}

document.getElementById('teacherName').addEventListener('keydown',e=>{if(e.key==='Enter')checkLogin();});
document.getElementById('adminPwd').addEventListener('keydown',e=>{if(e.key==='Enter')checkAdminLogin();});


initStats();
</script>
</body>
</html>
